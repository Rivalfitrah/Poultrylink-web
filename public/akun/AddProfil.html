<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="../src/output.css" rel="stylesheet" />
    <link rel="stylesheet" href="../src/css/style.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@heroicons/react/outline"></script>
    <title>PoultryLink</title>
    <link rel="icon" href="../src/img/logo.svg" />
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="flex justify-center items-center min-h-screen bg-gray-100">
      <div class="bg-white w-full max-w-lg p-8 rounded-lg shadow-lg">
        <!-- Logo dan Judul -->
        <div class="flex items-center justify-center mb-6">
          <img
            src="../src/img/logo.svg"
            alt="Logo PoultryLink"
            class="w-24 h-24 mr-2"
          />
          <h2 class="text-4xl font-bold text-primary">PoultryLink</h2>
        </div>
        <!-- Form Input -->
        <form id="addprofile_form" enctype="multipart/form-data">
          <div class="mb-6 text-center">
            <label class="block mb-2 text-gray-700 font-semibold">Foto Profil</label>
            
            <!-- Avatar container -->
            <div class="relative w-32 h-32 mx-auto rounded-full overflow-hidden bg-gray-200 border-4 border-primary">
              <!-- Image element -->
              <img
                id="imageUploadPreview"
                src="#"
                alt="Foto Profil"
                class="w-full h-full object-cover hidden"
              />
              
              <!-- Placeholder text -->
              <div
                id="placeholder"
                class="flex items-center justify-center w-full h-full text-gray-400"
              >
                <span class="text-sm">Unggah Foto</span>
              </div>
            </div>
            
            <!-- Custom Button for Upload -->
            <label
              for="avatar_path"
              class="inline-flex items-center justify-center w-auto px-6 py-2 mt-4 font-semibold text-white bg-primary rounded-md cursor-pointer hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
            >
              Pilih Foto
              <input
                type="file"
                id="avatar_path"
                name="avatar_path"
                accept="image/*"
                class="hidden"
                onchange="previewImage(event)"
              />
            </label>
          </div>

          <!-- First Name -->
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2"
              >First Name</label
            >
            <input
              type="text"
              placeholder="Masukkan First Name"
              class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"
              id="firstname"
              name="firstname"
              required
            />
          </div>

          <!-- Last Name -->
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2"
              >Last Name</label
            >
            <input
              type="text"
              placeholder="Masukkan Last Name"
              class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"
              id="lastname"
              name="lastname"
              required
            />
          </div>

          <!-- Nomor Telepon -->
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2"
              >No. Telepon</label
            >
            <input
              type="tel"
              placeholder="Masukkan nomor telepon"
              class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"
              id="telepon"
              name="telepon"
              required
            />
          </div>

          <!-- Alamat Lengkap -->
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2"
              >Alamat Lengkap</label
            >
            <input
              type="text"
              placeholder="Masukkan alamat lengkap"
              class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"
              id="alamat"
              name="alamat"
              required
            />
          </div>

          <!-- Kota -->
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2">Kota</label>
            <input
              type="text"
              placeholder="Masukkan kota"
              class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"
              id="kota"
              name="kota"
              required
            />
          </div>

          <!-- Kode Pos -->
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2"
              >Kode Pos</label
            >
            <input
              type="text"
              placeholder="Masukkan kode pos"
              class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"
              id="kodepos"
              name="kodepos"
              required
            />
          </div>

          <!-- Provinsi -->
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2"
              >Provinsi</label
            >
            <input
              type="text"
              placeholder="Masukkan provinsi"
              class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"
              id="provinsi"
              name="provinsi"
              required
            />
          </div>

          <!-- Negara -->
          <div class="mb-6">
            <label class="block text-gray-700 font-semibold mb-2">Negara</label>
            <input
              type="text"
              placeholder="Masukkan negara"
              class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"
              id="negara"
              name="negara"
              required
            />
          </div>

          <!-- Tombol Submit -->
          <div class="text-center">
            <button
              type="submit"
              class="w-full bg-primary text-white font-semibold py-2 px-4 rounded-md hover:bg-primary-dark focus:ring-2 focus:ring-offset-2 focus:ring-primary"
              id="submit"
            >
              Simpan Profil
            </button>
          </div>
        </form>
      </div>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      $(document).ready(function () {
    const base_url = window.location.origin;
    var token = localStorage.getItem("auth_token");

    $("#addprofile_form").on("submit", function (event) {
        event.preventDefault();
        var formData = new FormData(this);
        
        if (token) {
            $.ajax({
                type: "POST",
                url: "http://poultrylink.ambatuwin.xyz/api/updateprofile",
                headers: {
                    Authorization: "Bearer " + token,
                },
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Success",
                            text: response.message,
                            icon: "success",
                            confirmButtonText: "Ok",
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location = base_url + "/public/home.html";
                            }
                        });
                    } else {
                        Swal.fire({
                            title: "Error",
                            text: response.message || "Gagal menyimpan profil. Silakan coba lagi.",
                            icon: "error",
                        });
                    }
                    console.log(response);
                },
                error: function (xhr) {
                    let errorMessage = xhr.responseJSON?.message || "Terjadi kesalahan pada server.";
                    Swal.fire({
                        title: "Error",
                        text: errorMessage,
                        icon: "error",
                    });
                },
            });
        } else {
            Swal.fire({
                title: "Error",
                text: "Token tidak ditemukan. Silakan login atau register ulang.",
                icon: "error",
            });
        }
    });
});

    </script>
    

    <script>
      // Function to preview the image once selected
      function previewImage(event) {
        const file = event.target.files[0];
        const reader = new FileReader();

        // Once the file is loaded, set the image source and show the image
        reader.onload = function (e) {
          const image = document.getElementById("imageUploadPreview");
          const placeholder = document.getElementById("placeholder");

          // Show image and hide placeholder
          image.src = e.target.result;
          image.classList.remove("hidden");
          placeholder.classList.add("hidden");
        };

        // Read the file as a Data URL
        if (file) {
          reader.readAsDataURL(file);
        }
      }
    </script>
  </body>
</html>
